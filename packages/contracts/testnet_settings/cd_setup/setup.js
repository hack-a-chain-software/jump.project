const nearAPI = require("near-api-js");
const { BN, KeyPair } = require("near-workspaces");
const fs = require("fs");
const crypto = require("crypto");

const {
  connect,
  keyStores,
  accountCreator: { UrlAccountCreator },
} = nearAPI;

const { storeData, createAccount, registerContracts } = require("./utils");

testnetSetup();

async function testnetSetup() {
  // set connection
  const CREDENTIALS_DIR = "../.near-credentials";
  const keyStore = new keyStores.UnencryptedFileSystemKeyStore(CREDENTIALS_DIR);

  const config = {
    networkId: "testnet",
    nodeUrl: "https://rpc.testnet.near.org",
    walletUrl: "https://wallet.testnet.near.org",
    helperUrl: "https://helper.testnet.near.org",
    explorerUrl: "https://explorer.testnet.near.org",
    deps: { keyStore },
  };

  const near = await connect(config);
  const accountCreator = new UrlAccountCreator(near, config.helperUrl);

  let last_block = await near.connection.provider.block({ finality: "final" });
  let last_block_height = last_block.header.height;

  let execution_data = {
    near,
    keyStore,
    accountCreator,
    config,
    accountMap: {},
    connAccountMap: {},
  };

  // save all base accounts to be created
  const random_prefix = crypto.randomBytes(10).toString("hex");
  execution_data.accountMap = {
    ...execution_data.accountMap,
    prefix: random_prefix,
    ownerAccount: random_prefix + "owner.testnet",
    jumpTokenAccount: random_prefix + "jump_token.testnet",
    xTokenAccount: random_prefix + "xjump_token.testnet",
    lockedTokenAccount: random_prefix + "locked_token.testnet",
    nftStaking: random_prefix + "nft_staking.testnet",
    launchpad: random_prefix + "launchpad.testnet",
    last_block_height: last_block_height,
  };
  storeData(execution_data.accountMap, "../account_map.json");

  // create accounts
  execution_data.connAccountMap.ownerAccount = await createAccount(
    execution_data.accountMap.ownerAccount,
    execution_data
  );
  execution_data.connAccountMap.jumpTokenAccount = await createAccount(
    execution_data.accountMap.jumpTokenAccount,
    execution_data
  );
  execution_data.connAccountMap.xTokenAccount = await createAccount(
    execution_data.accountMap.xTokenAccount,
    execution_data
  );
  execution_data.connAccountMap.lockedTokenAccount = await createAccount(
    execution_data.accountMap.lockedTokenAccount,
    execution_data
  );
  execution_data.connAccountMap.nftStaking = await createAccount(
    execution_data.accountMap.nftStaking,
    execution_data
  );
  execution_data.connAccountMap.launchpad = await createAccount(
    execution_data.accountMap.launchpad,
    execution_data
  );

  // deploy and initialize core contracts

  // JUMP token

  const token_contract = fs.readFileSync("../../out/token_contract.wasm");
  await execution_data.connAccountMap.jumpTokenAccount.deployContract(
    token_contract
  );
  await execution_data.connAccountMap.jumpTokenAccount.functionCall({
    contractId: execution_data.connAccountMap.jumpTokenAccount.accountId,
    methodName: "new",
    args: {
      owner_id: execution_data.connAccountMap.ownerAccount.accountId,
      total_supply: "1000000000000000000000000000",
      metadata: {
        spec: "ft-1.0.0",
        name: "Jump",
        symbol: "JUMP",
        icon: "data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg id='Layer_2' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' viewBox='0 0 590 590.14'%3E%3Cdefs%3E%3Cstyle%3E.cls-1%7Bfill:url(%23linear-gradient);%7D%3C/style%3E%3ClinearGradient id='linear-gradient' x1='99.48' y1='490.31' x2='495.26' y2='94.53' gradientTransform='matrix(1, 0, 0, 1, 0, 0)' gradientUnits='userSpaceOnUse'%3E%3Cstop offset='.03' stop-color='%23392b42'/%3E%3Cstop offset='1' stop-color='%236e3b86'/%3E%3C/linearGradient%3E%3C/defs%3E%3Cpath class='cls-1' d='M320.62,28.06c.62-4.84,5.02-8.25,9.88-7.63,33.88,4.35,66.3,14.83,96.35,31.15,4.29,2.33,5.87,7.69,3.55,11.97-1.52,2.8-4.33,4.45-7.29,4.6-1.58,.08-3.19-.25-4.68-1.06-28.13-15.28-58.47-25.09-90.18-29.16-4.83-.62-8.25-5.04-7.63-9.88Zm-120.71,25.32c.9-.05,1.8-.23,2.68-.57,25.07-9.57,51.5-15.15,78.56-16.6,4.87-.26,8.6-4.42,8.34-9.29-.26-4.87-4.42-8.6-9.29-8.34-28.89,1.55-57.12,7.51-83.91,17.74-4.55,1.73-6.84,6.84-5.1,11.39,1.4,3.67,4.99,5.87,8.72,5.67Zm249.14,28.46c13.96,8.9,27.11,19.16,39.07,30.51,3.54,3.36,9.12,3.21,12.48-.33,3.36-3.53,3.22-9.13-.33-12.48-12.78-12.12-26.82-23.09-41.74-32.59-4.11-2.62-9.57-1.41-12.19,2.7-1.62,2.55-1.77,5.62-.67,8.22,.67,1.58,1.82,2.98,3.37,3.97Zm-144.14-4.07c47.94,2.13,94.53,20.52,131.17,51.8,1.79,1.53,4.02,2.22,6.2,2.1,2.33-.12,4.61-1.17,6.24-3.09,3.17-3.71,2.73-9.28-.98-12.44-39.62-33.82-90-53.71-141.85-56.02-4.92-.25-9,3.56-9.21,8.43-.22,4.87,3.56,9,8.43,9.21Zm-130.22,34.69c1.46-.08,2.92-.52,4.24-1.35,25.17-15.92,52.86-26.33,82.32-30.92,4.82-.75,8.12-5.26,7.36-10.08-.75-4.82-5.35-8.06-10.08-7.36-31.86,4.97-61.82,16.23-89.03,33.45-4.12,2.61-5.35,8.06-2.74,12.18,1.77,2.79,4.85,4.26,7.94,4.09Zm303.57,197.31c.26,0,.52,0,.77,0,4.52-.24,8.19-3.92,8.34-8.53,.18-5.46,.12-11.04-.18-16.6-1.39-25.95-7.82-50.86-19.12-74.02-2.13-4.37-7.4-6.19-11.81-4.06-4.38,2.14-6.2,7.42-4.06,11.81,10.26,21.03,16.1,43.65,17.36,67.22,.27,5.05,.33,10.12,.17,15.08-.16,4.88,3.66,8.96,8.53,9.11ZM276.37,112.04c.26,4.87,4.42,8.6,9.29,8.34,8.66-.46,17.41-.29,26,.51,.44,.05,.88,.05,1.31,.03,4.3-.23,7.89-3.58,8.3-7.99,.46-4.85-3.11-9.16-7.96-9.61-9.45-.89-19.07-1.08-28.59-.57-4.87,.26-8.6,4.42-8.34,9.29Zm-22.99-5.04c-20.85,4.6-40.67,12.6-58.88,23.77-4.16,2.55-5.46,7.98-2.91,12.14,1.76,2.86,4.88,4.37,8.01,4.2,1.42-.08,2.84-.5,4.14-1.29,16.54-10.14,34.52-17.4,53.45-21.57,4.76-1.05,7.77-5.76,6.72-10.52-1.05-4.76-5.73-7.72-10.52-6.72Zm62.7,463.77c-142.34,10.83-271.36-90.15-294.14-231.07C6.86,246.44,39.41,153.98,107.87,91.06c3.59-3.29,9.17-3.06,12.47,.53,3.3,3.59,3.06,9.17-.53,12.47-37.97,34.9-64.13,79.51-76.22,128.23,2.68-1.66,5.8-2.32,8.98-1.71,6.58,1.23,10.07,6.81,13.03,13.54,11.55-51.91,40.53-99.2,83.03-133.09,3.82-3.04,9.37-2.41,12.41,1.4,3.04,3.81,2.41,9.37-1.4,12.4-43.33,34.55-71.47,84.16-79.56,137.95,3.08,1.29,6.93,2.23,11.86,2.5,4.05,.17,8.51-.86,13.26-2.76,7.51-44.85,30.7-85.57,66.73-115.59,3.74-3.12,9.31-2.62,12.43,1.14,3.12,3.74,2.61,9.31-1.13,12.43-28.8,23.99-48.53,55.51-57.52,90.47,4.4-2.98,8.91-6.24,13.46-9.6,12.68-9.37,28.41-24.31,41.06-36.32,6.07-5.77,11.81-11.22,16.42-15.31,9.81-8.7,39.67-35.15,82.72-23.2,40,11.11,55.24,34.38,67.43,57.26,.12,.22,.23,.45,.33,.68,.8,1.79,1.82,3.85,2.64,5.3,3.73,1.15,11.21,2.92,16.08,3.94-7.62-5.97-12.73-14.71-14.75-18.56-2.2-4.2-6.27-12-.8-18.56,5.25-6.29,12.84-3.91,16.09-2.9,.37,.12,.81,.23,1.31,.35l.38,.1c6.56,1.68,20.18,5.15,31.72,20.03,3.44,2.75,20.22,12.08,28.38,16.6,21.16,11.76,23.95,13.4,26.11,17.14,1.27,2.18,5.08,8.78-4.74,21.76-2.3,5.67-8.37,11.77-18.05,10.83-1.54-.15-3.29-.47-5.51-.88-6.16-1.12-20.56-3.74-25.79,.25-1.75,1.34-7.84,6.58-13.21,11.2-5.32,4.58-10.75,9.25-14.25,12.13-9.47,7.8-15.94,9.4-26.66,12.04-7.24,1.79-8.36,3.17-13.73,9.81-3.94,4.88-7.94,11.15-10.58,15.3-1.3,2.04-2.32,3.62-2.95,4.48-3.77,5.22-9.2,10.22-21.12,7.84-.87-.18-1.89-.38-2.99-.65,1.68,11.35,4.6,16.28,9.98,22.15,6.3,6.88,18.06,14.44,23.39,16.62,1.03,.42,2.18,.86,3.41,1.31,7.19,2.71,16.84,6.34,23.07,13.57,4.91,5.71,7.37,9.3,8.71,12.8,2.78,2.1,7.9,6.47,9.28,14.75l.16,.69c1.56,6.58-1.96,11.09-5.45,12.95-.74,.39-2.72,1.3-5.28,1.3-2,0-4.89-.57-7.67-3.14-3.07,1.04-6.34,.83-9.74-.62-5.35,2.17-11.08,.47-17.03-5.03l-1.68-1.56c-5.73-5.35-14.38-13.41-27.89-23-8.52-6.06-15.87-9.82-21.78-12.85-4.72-2.42-8.44-4.32-11.63-6.73-9.57-7.24-9.84-12.91-9.51-23.12l.1-3.62c.29-10.37,.65-23.27-2.09-41.82-2.06-13.94-16.44-23.84-30.34-33.42-5.11-3.52-9.91-6.83-14.14-10.36-7.44-6.21-11.98-10.31-14.98-13.02-1.08-.98-1.99-1.8-2.71-2.43-.66,.37-1.37,.77-2.05,1.16-1.28,.73-2.97,1.82-5.1,3.21-8.7,5.64-23.2,15.05-45.47,24.24-6.2,2.56-12.15,4.59-17.86,6.14,.02,.48,0,.96,.03,1.44,4.43,88.3,72.19,158.63,160.33,165.53,79.83,6.25,151.83-41.17,178.55-114.43,1.51-4.15,5.68-7.01,10.03-6.2,5.53,1.03,8.58,6.65,6.76,11.7-24.38,67.48-83.64,115.04-153.69,125.05-6.36,.91-10.97,6.52-10.63,12.93v.04c.39,7.32,7,12.73,14.26,11.69,110.06-15.79,192.07-113.57,186.01-226.68-1.36-25.33-7.01-49.92-16.81-73.08-2.08-4.93,.65-10.69,6.08-12.03,4.25-1.05,8.64,1.49,10.34,5.53,11.13,26.44,17.27,54.59,18.23,83.57,4.05,122.36-88.77,228.83-210.55,241.38-74.39,7.66-143.56-20.12-191.74-69.05-4.38-4.45-11.47-4.69-16.22-.63h-.01c-5.3,4.55-5.62,12.64-.73,17.61,50.28,50.97,121.26,81.08,198.21,76.96,142.63-7.64,252.45-129.88,244.81-272.51-2.26-42.16-14.86-83.44-36.45-119.38-2.76-4.6-.85-10.69,4.34-12.77,4.07-1.63,8.77,.29,11.03,4.06,22.93,38.31,36.32,82.27,38.72,127.14,8.05,150.25-105.94,279.32-255.22,290.68ZM102.84,305.46c-9,.8-17.32,.08-24.99-2.15,.04,1.07,.07,2.14,.12,3.22,5.93,110.83,94.35,198.03,202.44,205.23,7.45,.5,13.67-5.67,13.27-13.12-.33-6.25-5.26-11.29-11.51-11.7-95.68-6.32-173.97-83.41-179.34-181.47Zm-56.47-53.45c-.29,7.24,4.49,20.4,16.64,31.4,18.81,15.48,43.12,13.75,70.47,2.46,27.35-11.29,42.83-23.15,49.2-26.77,6.37-3.62,7.67-4.34,11-2.75,3.33,1.59,5.64,4.92,21.42,18.09,15.77,13.17,44.68,25.92,48.33,50.65,3,20.31,2.46,34.44,2.17,45-.29,10.56-.87,11.87,5.06,16.35,5.93,4.49,17.65,8.39,33.14,19.39,15.48,11,24.74,19.97,30.68,25.47,5.93,5.5,6.51,2.03,6.51,.29s.29-2.17,4.77,1.16c4.49,3.33,5.64,1.74,5.79-.72,.14-2.46,.72-2.32,5.64,1.3,4.92,3.62,4.63,5.5,3.91,1.88-1.16-7.38-7.81-8.54-8.25-11s-1.88-5.06-7.24-11.29c-5.35-6.22-15.92-9.26-22.28-11.87-6.37-2.6-19.54-10.85-27.35-19.39-7.81-8.54-11.87-16.35-13.6-35.16-1.74-18.81-2.12-32.56-2.75-38.93-1.27-12.81,9.85-25.04,15.1-27.66,11.74-5.87,19.56,4.27,17.17,17.82-1.5,8.52-7.24,27.64-7.67,28.65-.43,1.01-4.34,6.22-4.34,6.22,0,0-3.33-.29-3.76-.87-.43-.58-1.01-6.37-2.6-6.37s-1.74,5.5-2.17,9.98c-.43,4.49,1.45,5.21,7.96,6.51,6.51,1.3,8.1-.87,9.98-3.47,1.88-2.6,7.81-12.73,13.89-20.26,6.08-7.53,9.12-11,19.68-13.6,10.56-2.6,14.9-3.76,22.28-9.84,7.38-6.08,24.03-20.72,27.78-23.59,11.11-8.48,33.14-2.17,39.07-1.59,5.93,.58,7.08-5.12,7.08-5.12,0,0,6.66-8.19,5.07-10.94-1.59-2.75-49.49-27.06-53.25-31.98-10.71-14.18-23.73-15.77-28.36-17.22-4.63-1.45-6.22-1.88-2.21,5.79,4.01,7.67,10.89,16.21,17.69,18.23,6.8,2.03,6.51,3.47,5.79,4.92-.72,1.45-14.18,12.45-16.5,12.16-2.32-.29-23.3-4.78-25.32-6.66-2.03-1.88-5.5-9.7-5.5-9.7-13.02-24.46-26.77-42.4-60.63-51.81-33.86-9.41-58.39,8.38-72.43,20.82-14.04,12.45-38.85,37.93-58.24,52.25-19.39,14.33-37.48,26.97-54.41,26.05-24.85-1.35-31.4-16.79-33.72-22.57-2.32-5.79-4.78-11.87-7.09-12.3-2.32-.43-3.33,3.33-3.62,10.56Zm245.39,62.51c.74-.13,1.52-.19,2.32-.19,.95,0,1.86,.1,2.72,.29,1.95-6.78,4.03-14.59,4.77-18.8,.59-3.37,.04-5.51-.37-6.43-.26,.08-.59,.22-.98,.41-2.19,1.09-9.78,9.32-9.05,16.69,.21,2.08,.38,4.76,.57,8.03Zm-189.57,114.57c-24.24-34.7-39.42-76.33-41.85-121.62-.23-4.3-.33-8.6-.32-12.88-1.18-.84-2.34-1.71-3.48-2.65l-.37-.32c-9.64-8.72-15.56-18.83-18.36-27.7-1.76,14.74-2.28,29.72-1.47,44.82,2.67,49.85,19.37,95.66,46.02,133.87,4.06,5.83,12.28,6.89,17.68,2.27,4.62-3.96,5.62-10.8,2.14-15.79Z'/%3E%3C/svg%3E",
        reference: null,
        reference_hash: null,
        decimals: 18,
      },
    },
  });

  // xJUMP

  const x_token_contract = fs.readFileSync("../../out/x_token.wasm");
  await execution_data.connAccountMap.xTokenAccount.deployContract(
    x_token_contract
  );
  await execution_data.connAccountMap.xTokenAccount.functionCall({
    contractId: execution_data.connAccountMap.xTokenAccount.accountId,
    methodName: "new",
    args: {
      x_token_name: "xJump",
      x_token_symbol: "XJMP",
      x_token_icon:
        "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' viewBox='0 0 553.39 552.99'%3E%3Cdefs%3E%3Cstyle%3E.cls-1%7Bfill:url(%23linear-gradient);%7D%3C/style%3E%3ClinearGradient id='linear-gradient' x1='81.17' y1='471.73' x2='476.95' y2='75.95' gradientUnits='userSpaceOnUse'%3E%3Cstop offset='0.25' stop-color='%23512770'/%3E%3Cstop offset='1' stop-color='%23731112'/%3E%3C/linearGradient%3E%3C/defs%3E%3Cg id='Layer_2' data-name='Layer 2'%3E%3Cg id='Full_Colour' data-name='Full Colour'%3E%3Cpath class='cls-1' d='M302.31,9.49a8.8,8.8,0,0,1,9.88-7.63A274.11,274.11,0,0,1,408.54,33a8.83,8.83,0,0,1-8.42,15.52,256.45,256.45,0,0,0-90.18-29.16A8.83,8.83,0,0,1,302.31,9.49ZM181.6,34.81a8.75,8.75,0,0,0,2.68-.57,258.76,258.76,0,0,1,78.56-16.6A8.83,8.83,0,0,0,261.9,0,276.58,276.58,0,0,0,178,17.75a8.82,8.82,0,0,0,3.61,17.06ZM430.74,63.27a259.14,259.14,0,0,1,39.07,30.51A8.83,8.83,0,0,0,482,81a277,277,0,0,0-41.74-32.59,8.83,8.83,0,0,0-9.49,14.89ZM286.6,59.2A218,218,0,0,1,417.78,111a8.83,8.83,0,0,0,11.46-13.43,235.65,235.65,0,0,0-141.85-56,8.83,8.83,0,1,0-.79,17.64ZM156.38,93.88a8.65,8.65,0,0,0,4.24-1.35,215,215,0,0,1,82.31-30.92,8.83,8.83,0,1,0-2.72-17.45,232.69,232.69,0,0,0-89,33.45,8.82,8.82,0,0,0,5.2,16.27ZM460,291.2c.26,0,.51,0,.77,0a8.84,8.84,0,0,0,8.34-8.53c.17-5.46.11-11-.19-16.59a191.42,191.42,0,0,0-19.11-74,8.84,8.84,0,0,0-15.88,7.75A173.6,173.6,0,0,1,451.24,267c.27,5.05.33,10.13.17,15.08A8.82,8.82,0,0,0,460,291.2ZM258.06,93.46a8.83,8.83,0,0,0,9.29,8.35,177.44,177.44,0,0,1,26,.51,8.22,8.22,0,0,0,1.31,0,8.83,8.83,0,0,0,.34-17.6,194.77,194.77,0,0,0-28.59-.57A8.83,8.83,0,0,0,258.06,93.46Zm-23-5a191.14,191.14,0,0,0-58.88,23.77,8.83,8.83,0,0,0,5.09,16.34,8.92,8.92,0,0,0,4.14-1.29,173.31,173.31,0,0,1,53.45-21.57,8.83,8.83,0,0,0-3.8-17.25Zm62.7,463.77C155.43,563,26.41,462,3.63,321.12-11.45,227.87,21.1,135.41,89.56,72.49a8.83,8.83,0,0,1,12,13A258.57,258.57,0,0,0,25.29,213.72a12.41,12.41,0,0,1,9-1.71c6.58,1.23,10.07,6.81,13,13.53a235.73,235.73,0,0,1,83-133.08,8.83,8.83,0,1,1,11,13.8,218.12,218.12,0,0,0-79.56,138,35.17,35.17,0,0,0,11.86,2.5c4,.18,8.51-.86,13.26-2.76a190.86,190.86,0,0,1,66.74-115.58,8.82,8.82,0,1,1,11.29,13.56,173.69,173.69,0,0,0-57.51,90.48c4.4-3,8.91-6.24,13.46-9.61,12.68-9.36,28.41-24.31,41.06-36.32,6.07-5.77,11.8-11.22,16.42-15.31,9.81-8.7,39.67-35.15,82.71-23.2,40,11.11,55.25,34.38,67.43,57.26.12.22.23.45.34.68.8,1.79,1.82,3.85,2.63,5.3,3.73,1.15,11.21,2.92,16.08,3.94-7.62-6-12.74-14.71-14.75-18.56-2.2-4.2-6.28-12-.8-18.56,5.25-6.29,12.84-3.91,16.09-2.9.37.12.81.23,1.31.35l.38.1c6.56,1.68,20.18,5.15,31.72,20,3.43,2.75,20.22,12.08,28.37,16.6C431,224,433.82,225.62,436,229.35c1.26,2.18,5.08,8.78-4.74,21.76a17.25,17.25,0,0,1-18.05,10.83c-1.54-.15-3.29-.47-5.51-.88-6.16-1.12-20.55-3.74-25.79.25-1.75,1.34-7.84,6.58-13.21,11.2s-10.75,9.25-14.25,12.14c-9.47,7.8-15.95,9.39-26.67,12-7.24,1.78-8.36,3.17-13.73,9.81a178.2,178.2,0,0,0-10.58,15.3c-1.3,2-2.32,3.62-2.94,4.48-3.77,5.22-9.2,10.23-21.12,7.85-.87-.18-1.89-.38-3-.65,1.69,11.35,4.61,16.27,10,22.15,6.31,6.88,18.06,14.44,23.39,16.62,1,.42,2.18.86,3.41,1.32,7.18,2.7,16.84,6.34,23.06,13.57,4.91,5.71,7.37,9.3,8.71,12.8a22.67,22.67,0,0,1,9.28,14.75l.16.68a11.23,11.23,0,0,1-5.46,13,11.54,11.54,0,0,1-5.27,1.3,11.1,11.1,0,0,1-7.67-3.15,13.33,13.33,0,0,1-9.74-.62c-5.35,2.17-11.09.48-17-5l-1.68-1.56a252.34,252.34,0,0,0-27.89-23,165.77,165.77,0,0,0-21.78-12.86c-4.72-2.42-8.44-4.32-11.63-6.73-9.56-7.24-9.84-12.91-9.51-23.12l.1-3.62a218.79,218.79,0,0,0-2.09-41.82c-2.06-13.94-16.44-23.84-30.34-33.42-5.12-3.52-9.91-6.83-14.14-10.36-7.44-6.21-12-10.3-15-13-1.08-1-2-1.81-2.71-2.43l-2.06,1.16c-1.28.73-3,1.82-5.1,3.21a262.86,262.86,0,0,1-45.47,24.24,148.79,148.79,0,0,1-17.86,6.14c0,.48,0,1,0,1.43,4.43,88.31,72.19,158.63,160.34,165.53A174.73,174.73,0,0,0,441,336.18c1.51-4.15,5.69-7,10-6.2a8.84,8.84,0,0,1,6.76,11.7A192,192,0,0,1,304.09,466.73a12.4,12.4,0,0,0-10.63,12.93v0a12.5,12.5,0,0,0,14.26,11.69c110-15.8,192.07-113.57,186-226.68a216.68,216.68,0,0,0-16.81-73.08,8.83,8.83,0,0,1,6.08-12,9.12,9.12,0,0,1,10.34,5.53,234.62,234.62,0,0,1,18.23,83.56C515.62,391.05,422.8,497.53,301,510.08A234.43,234.43,0,0,1,109.29,441a11.91,11.91,0,0,0-16.22-.63h0a12,12,0,0,0-.72,17.6,258.39,258.39,0,0,0,198.21,77C433.17,527.33,543,405.08,535.35,262.46A259.44,259.44,0,0,0,498.9,143.08a8.84,8.84,0,0,1,4.34-12.77,9.16,9.16,0,0,1,11,4.06A277.33,277.33,0,0,1,553,261.51C561,411.76,447.05,540.84,297.77,552.19ZM84.53,286.88a67.46,67.46,0,0,1-25-2.15c0,1.07.06,2.15.12,3.22C65.6,398.78,154,486,262.11,493.18a12.45,12.45,0,0,0,1.76-24.83C168.19,462,89.9,384.94,84.53,286.88ZM28.06,233.43c-.28,7.24,4.49,20.4,16.65,31.4,18.81,15.49,43.12,13.75,70.47,2.46s42.83-23.15,49.2-26.77,7.67-4.34,11-2.75,5.64,4.92,21.41,18.09,44.69,25.92,48.34,50.65c3,20.31,2.46,34.44,2.17,45s-.87,11.87,5.06,16.35,17.66,8.4,33.14,19.39a273.16,273.16,0,0,1,30.68,25.47c5.93,5.5,6.51,2,6.51.29s.29-2.17,4.77,1.16,5.65,1.74,5.79-.72.73-2.32,5.65,1.3,4.63,5.5,3.9,1.88c-1.15-7.38-7.81-8.54-8.25-11s-1.88-5.06-7.23-11.28S311.4,385.08,305,382.48s-19.53-10.85-27.35-19.39-11.86-16.35-13.6-35.17S262,295.36,261.33,289c-1.26-12.81,9.85-25,15.1-27.66,11.74-5.87,19.56,4.27,17.17,17.82-1.5,8.52-7.23,27.64-7.67,28.65s-4.34,6.22-4.34,6.22-3.33-.29-3.76-.87-1-6.36-2.61-6.36-1.73,5.5-2.17,10,1.45,5.21,8,6.51,8.11-.86,10-3.47,7.81-12.73,13.89-20.26,9.12-11,19.68-13.6,14.9-3.76,22.28-9.84,24-20.72,27.79-23.59c11.1-8.48,33.14-2.17,39.07-1.59s7.08-5.12,7.08-5.12,6.67-8.19,5.07-10.94-49.49-27.06-53.25-32c-10.71-14.18-23.73-15.78-28.36-17.22S338,183.8,342,191.47s10.89,16.2,17.69,18.23,6.52,3.47,5.79,4.92S351.34,227.06,349,226.77s-23.3-4.77-25.33-6.65-5.5-9.7-5.5-9.7c-13-24.45-26.77-42.4-60.63-51.8s-58.39,8.38-72.43,20.82-38.85,37.93-58.24,52.25-37.48,27-54.41,26.05c-24.85-1.35-31.4-16.78-33.72-22.57S34,223.3,31.68,222.87,28.35,226.2,28.06,233.43Zm245.39,62.51a13.45,13.45,0,0,1,2.32-.19,12.15,12.15,0,0,1,2.73.29c1.95-6.79,4-14.59,4.77-18.8a11.45,11.45,0,0,0-.37-6.43,7.25,7.25,0,0,0-1,.41c-2.18,1.09-9.77,9.31-9,16.69C273.08,290,273.26,292.67,273.45,295.94ZM83.88,410.51A233.55,233.55,0,0,1,42,288.89c-.23-4.3-.32-8.59-.32-12.87-1.17-.85-2.34-1.72-3.48-2.66l-.37-.32a64.31,64.31,0,0,1-18.36-27.7A260.22,260.22,0,0,0,18,290.16,257.3,257.3,0,0,0,64.06,424a12,12,0,0,0,17.68,2.27A11.9,11.9,0,0,0,83.88,410.51Z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E",
      x_token_decimals: 18,
      base_token_address:
        execution_data.connAccountMap.jumpTokenAccount.accountId,
    },
  });

  // LockedJUMP token

  const locked_token_contract = fs.readFileSync("../../out/locked_token.wasm");
  await execution_data.connAccountMap.lockedTokenAccount.deployContract(
    locked_token_contract
  );
  await execution_data.connAccountMap.lockedTokenAccount.functionCall({
    contractId: execution_data.connAccountMap.lockedTokenAccount.accountId,
    methodName: "new",
    args: {
      locked_token_name: "locked Jump",
      locked_token_symbol: "LOCKJMP",
      locked_token_icon:
        "data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg id='Layer_2' xmlns='http://www.w3.org/2000/svg' viewBox='0 0 590 590.14'%3E%3Cdefs%3E%3Cstyle%3E.cls-1%7Bfill:%23fff;%7D%3C/style%3E%3C/defs%3E%3Cpath class='cls-1' d='M320.62,28.06c.62-4.84,5.02-8.25,9.88-7.63,33.88,4.35,66.3,14.83,96.35,31.15,4.29,2.33,5.87,7.69,3.55,11.97-1.52,2.8-4.33,4.45-7.29,4.6-1.58,.08-3.19-.25-4.68-1.06-28.13-15.28-58.47-25.09-90.18-29.16-4.83-.62-8.25-5.04-7.63-9.88Zm-120.71,25.32c.9-.05,1.8-.23,2.68-.57,25.07-9.57,51.5-15.15,78.56-16.6,4.87-.26,8.6-4.42,8.34-9.29-.26-4.87-4.42-8.6-9.29-8.34-28.89,1.55-57.12,7.51-83.91,17.74-4.55,1.73-6.84,6.84-5.1,11.39,1.4,3.67,4.99,5.87,8.72,5.67Zm249.14,28.46c13.96,8.9,27.11,19.16,39.07,30.51,3.54,3.36,9.12,3.21,12.48-.33,3.36-3.53,3.22-9.13-.33-12.48-12.78-12.12-26.82-23.09-41.74-32.59-4.11-2.62-9.57-1.41-12.19,2.7-1.62,2.55-1.77,5.62-.67,8.22,.67,1.58,1.82,2.98,3.37,3.97Zm-144.14-4.07c47.94,2.13,94.53,20.52,131.17,51.8,1.79,1.53,4.02,2.22,6.2,2.1,2.33-.12,4.61-1.17,6.24-3.09,3.17-3.71,2.73-9.28-.98-12.44-39.62-33.82-90-53.71-141.85-56.02-4.92-.25-9,3.56-9.21,8.43-.22,4.87,3.56,9,8.43,9.21Zm-130.22,34.69c1.46-.08,2.92-.52,4.24-1.35,25.17-15.92,52.86-26.33,82.32-30.92,4.82-.75,8.12-5.26,7.36-10.08-.75-4.82-5.35-8.06-10.08-7.36-31.86,4.97-61.82,16.23-89.03,33.45-4.12,2.61-5.35,8.06-2.74,12.18,1.77,2.79,4.85,4.26,7.94,4.09Zm303.57,197.31c.26,0,.52,0,.77,0,4.52-.24,8.19-3.92,8.34-8.53,.18-5.46,.12-11.04-.18-16.6-1.39-25.95-7.82-50.86-19.12-74.02-2.13-4.37-7.4-6.19-11.81-4.06-4.38,2.14-6.2,7.42-4.06,11.81,10.26,21.03,16.1,43.65,17.36,67.22,.27,5.05,.33,10.12,.17,15.08-.16,4.88,3.66,8.96,8.53,9.11ZM276.37,112.04c.26,4.87,4.42,8.6,9.29,8.34,8.66-.46,17.41-.29,26,.51,.44,.05,.88,.05,1.31,.03,4.3-.23,7.89-3.58,8.3-7.99,.46-4.85-3.11-9.16-7.96-9.61-9.45-.89-19.07-1.08-28.59-.57-4.87,.26-8.6,4.42-8.34,9.29Zm-22.99-5.04c-20.85,4.6-40.67,12.6-58.88,23.77-4.16,2.55-5.46,7.98-2.91,12.14,1.76,2.86,4.88,4.37,8.01,4.2,1.42-.08,2.84-.5,4.14-1.29,16.54-10.14,34.52-17.4,53.45-21.57,4.76-1.05,7.77-5.76,6.72-10.52s-5.73-7.72-10.52-6.72Zm62.7,463.77c-142.34,10.83-271.36-90.15-294.14-231.07C6.86,246.44,39.41,153.98,107.87,91.06c3.59-3.29,9.17-3.06,12.47,.53,3.3,3.59,3.06,9.17-.53,12.47-37.97,34.9-64.13,79.51-76.22,128.23,2.68-1.66,5.8-2.32,8.98-1.71,6.58,1.23,10.07,6.81,13.03,13.54,11.55-51.91,40.53-99.2,83.03-133.09,3.82-3.04,9.37-2.41,12.41,1.4,3.04,3.81,2.41,9.37-1.4,12.4-43.33,34.55-71.47,84.16-79.56,137.95,3.08,1.29,6.93,2.23,11.86,2.5,4.05,.17,8.51-.86,13.26-2.76,7.51-44.85,30.7-85.57,66.73-115.59,3.74-3.12,9.31-2.62,12.43,1.14,3.12,3.74,2.61,9.31-1.13,12.43-28.8,23.99-48.53,55.51-57.52,90.47,4.4-2.98,8.91-6.24,13.46-9.6,12.68-9.37,28.41-24.31,41.06-36.32,6.07-5.77,11.81-11.22,16.42-15.31,9.81-8.7,39.67-35.15,82.72-23.2,40,11.11,55.24,34.38,67.43,57.26,.12,.22,.23,.45,.33,.68,.8,1.79,1.82,3.85,2.64,5.3,3.73,1.15,11.21,2.92,16.08,3.94-7.62-5.97-12.73-14.71-14.75-18.56-2.2-4.2-6.27-12-.8-18.56,5.25-6.29,12.84-3.91,16.09-2.9,.37,.12,.81,.23,1.31,.35l.38,.1c6.56,1.68,20.18,5.15,31.72,20.03,3.44,2.75,20.22,12.08,28.38,16.6,21.16,11.76,23.95,13.4,26.11,17.14,1.27,2.18,5.08,8.78-4.74,21.76-2.3,5.67-8.37,11.77-18.05,10.83-1.54-.15-3.29-.47-5.51-.88-6.16-1.12-20.56-3.74-25.79,.25-1.75,1.34-7.84,6.58-13.21,11.2-5.32,4.58-10.75,9.25-14.25,12.13-9.47,7.8-15.94,9.4-26.66,12.04-7.24,1.79-8.36,3.17-13.73,9.81-3.94,4.88-7.94,11.15-10.58,15.3-1.3,2.04-2.32,3.62-2.95,4.48-3.77,5.22-9.2,10.22-21.12,7.84-.87-.18-1.89-.38-2.99-.65,1.68,11.35,4.6,16.28,9.98,22.15,6.3,6.88,18.06,14.44,23.39,16.62,1.03,.42,2.18,.86,3.41,1.31,7.19,2.71,16.84,6.34,23.07,13.57,4.91,5.71,7.37,9.3,8.71,12.8,2.78,2.1,7.9,6.47,9.28,14.75l.16,.69c1.56,6.58-1.96,11.09-5.45,12.95-.74,.39-2.72,1.3-5.28,1.3-2,0-4.89-.57-7.67-3.14-3.07,1.04-6.34,.83-9.74-.62-5.35,2.17-11.08,.47-17.03-5.03l-1.68-1.56c-5.73-5.35-14.38-13.41-27.89-23-8.52-6.06-15.87-9.82-21.78-12.85-4.72-2.42-8.44-4.32-11.63-6.73-9.57-7.24-9.84-12.91-9.51-23.12l.1-3.62c.29-10.37,.65-23.27-2.09-41.82-2.06-13.94-16.44-23.84-30.34-33.42-5.11-3.52-9.91-6.83-14.14-10.36-7.44-6.21-11.98-10.31-14.98-13.02-1.08-.98-1.99-1.8-2.71-2.43-.66,.37-1.37,.77-2.05,1.16-1.28,.73-2.97,1.82-5.1,3.21-8.7,5.64-23.2,15.05-45.47,24.24-6.2,2.56-12.15,4.59-17.86,6.14,.02,.48,0,.96,.03,1.44,4.43,88.3,72.19,158.63,160.33,165.53,79.83,6.25,151.83-41.17,178.55-114.43,1.51-4.15,5.68-7.01,10.03-6.2,5.53,1.03,8.58,6.65,6.76,11.7-24.38,67.48-83.64,115.04-153.69,125.05-6.36,.91-10.97,6.52-10.63,12.93v.04c.39,7.32,7,12.73,14.26,11.69,110.06-15.79,192.07-113.57,186.01-226.68-1.36-25.33-7.01-49.92-16.81-73.08-2.08-4.93,.65-10.69,6.08-12.03,4.25-1.05,8.64,1.49,10.34,5.53,11.13,26.44,17.27,54.59,18.23,83.57,4.05,122.36-88.77,228.83-210.55,241.38-74.39,7.66-143.56-20.12-191.74-69.05-4.38-4.45-11.47-4.69-16.22-.63h-.01c-5.3,4.55-5.62,12.64-.73,17.61,50.28,50.97,121.26,81.08,198.21,76.96,142.63-7.64,252.45-129.88,244.81-272.51-2.26-42.16-14.86-83.44-36.45-119.38-2.76-4.6-.85-10.69,4.34-12.77,4.07-1.63,8.77,.29,11.03,4.06,22.93,38.31,36.32,82.27,38.72,127.14,8.05,150.25-105.94,279.32-255.22,290.68ZM102.84,305.46c-9,.8-17.32,.08-24.99-2.15,.04,1.07,.07,2.14,.12,3.22,5.93,110.83,94.35,198.03,202.44,205.23,7.45,.5,13.67-5.67,13.27-13.12-.33-6.25-5.26-11.29-11.51-11.7-95.68-6.32-173.97-83.41-179.34-181.47Zm-56.47-53.45c-.29,7.24,4.49,20.4,16.64,31.4,18.81,15.48,43.12,13.75,70.47,2.46,27.35-11.29,42.83-23.15,49.2-26.77,6.37-3.62,7.67-4.34,11-2.75,3.33,1.59,5.64,4.92,21.42,18.09,15.77,13.17,44.68,25.92,48.33,50.65,3,20.31,2.46,34.44,2.17,45-.29,10.56-.87,11.87,5.06,16.35,5.93,4.49,17.65,8.39,33.14,19.39,15.48,11,24.74,19.97,30.68,25.47,5.93,5.5,6.51,2.03,6.51,.29s.29-2.17,4.77,1.16c4.49,3.33,5.64,1.74,5.79-.72,.14-2.46,.72-2.32,5.64,1.3,4.92,3.62,4.63,5.5,3.91,1.88-1.16-7.38-7.81-8.54-8.25-11-.43-2.46-1.88-5.06-7.24-11.29-5.35-6.22-15.92-9.26-22.28-11.87-6.37-2.6-19.54-10.85-27.35-19.39-7.81-8.54-11.87-16.35-13.6-35.16-1.74-18.81-2.12-32.56-2.75-38.93-1.27-12.81,9.85-25.04,15.1-27.66,11.74-5.87,19.56,4.27,17.17,17.82-1.5,8.52-7.24,27.64-7.67,28.65-.43,1.01-4.34,6.22-4.34,6.22,0,0-3.33-.29-3.76-.87-.43-.58-1.01-6.37-2.6-6.37s-1.74,5.5-2.17,9.98c-.43,4.49,1.45,5.21,7.96,6.51,6.51,1.3,8.1-.87,9.98-3.47,1.88-2.6,7.81-12.73,13.89-20.26,6.08-7.53,9.12-11,19.68-13.6,10.56-2.6,14.9-3.76,22.28-9.84,7.38-6.08,24.03-20.72,27.78-23.59,11.11-8.48,33.14-2.17,39.07-1.59,5.93,.58,7.08-5.12,7.08-5.12,0,0,6.66-8.19,5.07-10.94-1.59-2.75-49.49-27.06-53.25-31.98-10.71-14.18-23.73-15.77-28.36-17.22-4.63-1.45-6.22-1.88-2.21,5.79,4.01,7.67,10.89,16.21,17.69,18.23,6.8,2.03,6.51,3.47,5.79,4.92-.72,1.45-14.18,12.45-16.5,12.16-2.32-.29-23.3-4.78-25.32-6.66-2.03-1.88-5.5-9.7-5.5-9.7-13.02-24.46-26.77-42.4-60.63-51.81-33.86-9.41-58.39,8.38-72.43,20.82-14.04,12.45-38.85,37.93-58.24,52.25-19.39,14.33-37.48,26.97-54.41,26.05-24.85-1.35-31.4-16.79-33.72-22.57-2.32-5.79-4.78-11.87-7.09-12.3-2.32-.43-3.33,3.33-3.62,10.56Zm245.39,62.51c.74-.13,1.52-.19,2.32-.19,.95,0,1.86,.1,2.72,.29,1.95-6.78,4.03-14.59,4.77-18.8,.59-3.37,.04-5.51-.37-6.43-.26,.08-.59,.22-.98,.41-2.19,1.09-9.78,9.32-9.05,16.69,.21,2.08,.38,4.76,.57,8.03Zm-189.57,114.57c-24.24-34.7-39.42-76.33-41.85-121.62-.23-4.3-.33-8.6-.32-12.88-1.18-.84-2.34-1.71-3.48-2.65l-.37-.32c-9.64-8.72-15.56-18.83-18.36-27.7-1.76,14.74-2.28,29.72-1.47,44.82,2.67,49.85,19.37,95.66,46.02,133.87,4.06,5.83,12.28,6.89,17.68,2.27,4.62-3.96,5.62-10.8,2.14-15.79Z'/%3E%3C/svg%3E",
      locked_token_decimals: 18,
      contract_config: {
        owner_id: execution_data.connAccountMap.ownerAccount.accountId,
        base_token: execution_data.connAccountMap.jumpTokenAccount.accountId,
        vesting_duration: (60 * 60 * 24 * 30).toString() + "000000000",
        fast_pass_cost: "500",
        fast_pass_acceleration: "2",
        fast_pass_beneficiary:
          execution_data.connAccountMap.xTokenAccount.accountId,
      },
    },
  });

  // NFT Staking contract

  const nft_staking_contract = fs.readFileSync("../../out/nft_staking.wasm");
  await execution_data.connAccountMap.nftStaking.deployContract(
    nft_staking_contract
  );
  await execution_data.connAccountMap.nftStaking.functionCall({
    contractId: execution_data.connAccountMap.nftStaking.accountId,
    methodName: "new",
    args: {
      owner_id: execution_data.connAccountMap.ownerAccount.accountId,
      contract_tokens: [
        execution_data.connAccountMap.lockedTokenAccount.accountId,
      ],
    },
  });

  // Launchpad contract

  const launchpad_contract = fs.readFileSync("../../out/launchpad.wasm");
  await execution_data.connAccountMap.launchpad.deployContract(
    launchpad_contract
  );
  await execution_data.connAccountMap.launchpad.functionCall({
    contractId: execution_data.connAccountMap.launchpad.accountId,
    methodName: "new",
    args: {
      owner: execution_data.connAccountMap.ownerAccount.accountId,
      contract_settings: {
        membership_token: execution_data.connAccountMap.xTokenAccount.accountId,
        token_lock_period: "86400000000000",
        tiers_minimum_tokens: [
          "1000000000000000000",
          "2000000000000000000",
          "3000000000000000000",
          "4000000000000000000",
          "5000000000000000000",
          "6000000000000000000",
        ],
        tiers_entitled_allocations: ["10", "20", "30", "40", "50", "60"],
        allowance_phase_2: "10",
        partner_dex: "dex_account.testnet",
      },
    },
  });

  // register contracts in eachother
  await registerContracts(
    [
      execution_data.connAccountMap.ownerAccount,
      execution_data.connAccountMap.jumpTokenAccount,
      execution_data.connAccountMap.xTokenAccount,
      execution_data.connAccountMap.lockedTokenAccount,
      execution_data.connAccountMap.nftStaking,
      execution_data.connAccountMap.launchpad,
    ],
    [
      execution_data.connAccountMap.jumpTokenAccount,
      execution_data.connAccountMap.xTokenAccount,
      execution_data.connAccountMap.lockedTokenAccount,
      execution_data.connAccountMap.nftStaking,
      execution_data.connAccountMap.launchpad,
    ]
  );

  // setup minters in locked jump
  const minterContracts = [
    execution_data.connAccountMap.ownerAccount,
    execution_data.connAccountMap.xTokenAccount,
    execution_data.connAccountMap.lockedTokenAccount,
    execution_data.connAccountMap.launchpad,
    execution_data.connAccountMap.nftStaking,
  ];
  const promisesMint = [];
  for (let minter of minterContracts) {
    promisesMint.push(
      ownerAccount.functionCall({
        contractId: execution_data.connAccountMap.lockedTokenAccount.accountId,
        methodName: "add_minter",
        args: {
          new_minter: minter.accountId,
        },
        attachedDeposit: new BN("1"),
      })
    );
  }
  await Promise.all(promisesMint);

  // setup NFT staking listings

  // setup Launchpad listings
}
